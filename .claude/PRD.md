# Habit Tracker - 产品需求文档

## 1. 概述

Habit Tracker 是一个个人习惯追踪 Web 应用，帮助用户通过简单的追踪和连续打卡来建立和保持日常习惯。应用提供无摩擦的方式记录每日习惯完成情况，可视化进度，并通过连续天数和完成率指标保持动力。

核心价值：简洁。本地优先的习惯追踪器，无需账户管理、社交功能或复杂的自定义选项。用户可以专注于养成习惯，不受干扰。

**MVP 目标**：交付一个功能完整的习惯追踪应用，支持每日完成记录、连续天数追踪、计划缺席和日历可视化——全部本地运行，无需认证。

---

## 2. 使命

**使命宣言**：提供简单、无干扰的工具，用于追踪日常习惯并通过可见的进度指标保持动力。

### 核心原则

1. **简洁优先** — 最少功能，最大效用
2. **即时反馈** — 完成习惯应感觉即时且令人满足
3. **激励而非内疚** — 积极展示进度；完成率配合连续天数防止士气低落
4. **本地私密** — 无账户，无云端，数据不离开用户机器
5. **聚焦每日** — 优化日常习惯；避免自定义计划的复杂性

---

## 3. 目标用户

### 主要画像：自我驱动的个人

- **谁**：在本地运行应用的单一用户
- **技术水平**：能够运行本地开发服务器或简单可执行文件
- **目标**：
  - 建立一致的日常习惯（运动、阅读、冥想等）
  - 看到一致性的视觉证明以保持动力
  - 简单追踪，无复杂应用的开销
- **痛点**：
  - 现有习惯追踪器功能臃肿
  - 不想创建账户或分享数据
  - 仅追踪连续天数在生活意外时感觉惩罚性

---

## 4. MVP 范围

### 包含

**核心功能**
- ✅ 创建、编辑、删除习惯
- ✅ 归档习惯（软删除，保留历史）
- ✅ 标记习惯为某天已完成
- ✅ 标记为"跳过"（计划缺席，不打断连续）
- ✅ 撤销完成/跳过
- ✅ 查看今日所有习惯及完成状态
- ✅ 每个习惯的当前连续天数计算
- ✅ 最长连续天数追踪（个人最佳保留）
- ✅ 每个习惯的完成率百分比
- ✅ 月度日历视图显示完成历史

**技术**
- ✅ Python 后端 + FastAPI
- ✅ SQLite 数据库持久化
- ✅ React 前端 + Vite
- ✅ Tailwind CSS 样式
- ✅ RESTful API 设计
- ✅ 本地开发设置（双终端工作流）

### 不包含

**延后功能**
- ❌ 非每日习惯（每周、特定日期）
- ❌ 提醒/通知
- ❌ 习惯分类/标签
- ❌ 午夜后宽限期
- ❌ 连续冻结（计划缺席已覆盖此用例）
- ❌ 数据导出（CSV、JSON）
- ❌ 深色模式
- ❌ 移动应用（仅响应式 Web）
- ❌ 多用户/认证
- ❌ 云同步
- ❌ 游戏化（徽章、积分）

---

## 5. 用户故事

1. **作为用户，我想创建新习惯，以便开始每日追踪。**
   - 示例：添加"晨间冥想"，描述"10分钟正念"

2. **作为用户，我想一键标记习惯完成，以便追踪无摩擦。**
   - 示例：点击"运动"旁的复选框，看到即时视觉反馈

3. **作为用户，我想在一个屏幕看到今日所有习惯，以便知道要做什么。**
   - 示例：仪表板显示 5 个习惯，3 个已完成，2 个待完成

4. **作为用户，我想看到每个习惯的当前连续天数，以便保持动力。**
   - 示例："阅读：14 天连续"醒目显示

5. **作为用户，我想为计划缺席标记"跳过"，以便假期不打断连续。**
   - 示例：出差时标记"运动"为跳过；返回后连续继续

6. **作为用户，我想看到完成率配合连续天数，以便一天失误不感觉失败。**
   - 示例："运动：5 天连续 | 87% 完成率"

7. **作为用户，我想查看习惯历史日历，以便看到时间模式。**
   - 示例：月度网格，绿色（完成）、灰色（跳过）、红色（错过）

8. **作为用户，我想归档旧习惯而不丢失历史，以便专注当前目标。**
   - 示例：归档"学西班牙语"但仍可查看历史数据

9. **作为用户，我想为每个习惯选择一个图标，以便在界面中快速识别不同的习惯。**
   - 示例：为"运动"选择跑步图标，为"阅读"选择书本图标
   - 图标显示在习惯列表、详情页、日历视图中

---

## 6. 核心架构

### 高层架构

```
┌─────────────────┐     HTTP/JSON      ┌─────────────────┐
│                 │ ◄───────────────► │                 │
│  React + Vite   │                    │    FastAPI      │
│   (前端)        │                    │   (后端)        │
│   端口 5173     │                    │   端口 8000     │
└─────────────────┘                    └────────┬────────┘
                                                │
                                                ▼
                                       ┌─────────────────┐
                                       │     SQLite      │
                                       │   (数据库)      │
                                       └─────────────────┘
```

### 目录结构

```
habit-tracker/
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI 应用入口
│   │   ├── database.py          # SQLite 连接和会话
│   │   ├── models.py            # SQLAlchemy ORM 模型
│   │   ├── schemas.py           # Pydantic 请求/响应模式
│   │   └── routers/
│   │       ├── habits.py        # 习惯 CRUD 端点
│   │       └── completions.py   # 完成/跳过端点
│   ├── habits.db                # SQLite 数据库文件
│   └── pyproject.toml
│
├── frontend/
│   ├── src/
│   │   ├── components/          # 可复用 UI 组件
│   │   ├── pages/               # 路由级组件
│   │   ├── api/                 # API 客户端函数
│   │   ├── App.jsx
│   │   └── main.jsx
│   └── package.json
│
└── .claude/
    └── PRD.md                   # 本文档
```

### 关键设计模式

- **仓储模式** — 数据库操作抽象在 models/routers
- **Pydantic 模式** — 请求验证和响应序列化
- **组件组合** — React 组件小而可组合
- **API 客户端层** — 前端 API 调用集中在 `api/` 目录
- **乐观 UI** — 立即更新 UI，后台同步服务器

---

## 7. 功能详情

### 7.1 习惯管理

**操作**：创建、编辑、归档、删除习惯

**关键特性**：
- 习惯名称必填，描述可选
- 可选颜色选择器用于视觉区分
- 可选图标选择器（使用 Lucide 图标库）用于快速识别
- 归档习惯从主视图隐藏但可访问

### 7.2 每日完成追踪

**操作**：标记完成、标记跳过、撤销

**关键特性**：
- 一键完成，即时视觉反馈
- 三种状态：完成（绿）、跳过（灰）、未完成（默认）
- 可修改今日和过去日期
- 每个习惯每天一条完成记录

### 7.3 连续天数追踪

**计算**：
- **当前连续**：连续完成天数（跳过不打断）
- **最长连续**：个人最佳，连续打断后保留
- **完成率**：(完成天数 / 习惯创建后总天数) × 100

### 7.4 日历视图

**特性**：
- 月度网格布局
- 颜色编码：绿（完成）、灰（跳过）、红（错过）
- 月份导航
- 点击日期查看/编辑完成状态

---

## 8. 技术栈

### 后端

| 组件 | 技术 |
|-----|-----|
| 框架 | FastAPI |
| 服务器 | Uvicorn |
| ORM | SQLAlchemy |
| 验证 | Pydantic |
| 数据库 | SQLite |

### 前端

| 组件 | 技术 |
|-----|-----|
| 框架 | React 18 |
| 构建 | Vite |
| 路由 | react-router-dom |
| 服务器状态 | TanStack Query |
| 样式 | Tailwind CSS |
| 日期工具 | date-fns |

---

## 9. API 规范

### 基础 URL
```
http://localhost:8000/api
```

### 习惯端点

**GET /api/habits** - 列出所有习惯及统计

**POST /api/habits** - 创建习惯
```json
{ "name": "阅读", "description": "每天20分钟", "color": "#3B82F6" }
```

**PUT /api/habits/{id}** - 更新习惯

**DELETE /api/habits/{id}** - 永久删除

**PATCH /api/habits/{id}/archive** - 归档习惯

### 完成端点

**POST /api/habits/{id}/complete** - 标记完成
```json
{ "date": "2025-01-04", "notes": "今天跑了5公里" }
```

**POST /api/habits/{id}/skip** - 标记跳过
```json
{ "date": "2025-01-04", "reason": "出差" }
```

**DELETE /api/habits/{id}/completions/{date}** - 删除记录

**GET /api/habits/{id}/completions** - 获取完成历史
```
?start=2025-01-01&end=2025-01-31
```

---

## 10. 成功标准

### MVP 成功定义

用户可以：
1. 添加新习惯并在仪表板看到
2. 每日完成习惯并看到连续增长
3. 计划缺席时跳过而不丢失连续
4. 在日历上查看完成历史
5. 通过可见进度指标保持动力

### 功能要求

- ✅ 习惯 CRUD 和归档
- ✅ 一键完成或跳过
- ✅ 准确计算当前连续
- ✅ 连续打断后保留最长连续
- ✅ 显示完成率百分比
- ✅ 渲染月度日历
- ✅ 数据跨会话持久化
- ✅ 正确处理日期边界

### 质量指标

- 页面加载 < 1 秒
- 完成操作反馈 < 100ms
- 正常使用无数据丢失
- 支持 Chrome、Firefox、Safari
- 响应式布局（桌面 + 移动浏览器）

---

## 11. 实现阶段

### 阶段1：后端基础
- ✅ 项目结构和 Python 虚拟环境
- ✅ SQLite 数据库（habits 和 completions 表）
- ✅ 习惯 CRUD 端点
- ✅ 完成/跳过端点
- ✅ 连续计算逻辑

### 阶段2：前端基础
- ✅ Vite + React 项目
- ✅ Tailwind CSS 配置
- ✅ TanStack Query API 客户端
- ✅ 仪表板页面
- ✅ 习惯创建表单
- ✅ 完成切换功能

### 阶段3：核心功能
- ✅ 连续和完成率显示
- ✅ 跳过功能
- ✅ 编辑和归档流程
- ✅ 日历视图组件
- ✅ 习惯详情页

### 阶段4：打磨
- ✅ 加载和错误状态
- ✅ 空状态（无习惯时）
- ✅ 破坏性操作确认对话框
- ✅ 移动响应式布局

---

## 12. 风险与缓解

| 风险 | 影响 | 缓解 |
|-----|-----|-----|
| 连续计算 bug | 用户失去信任 | 全面单元测试 |
| 数据丢失 | 应用价值归零 | SQLite 稳健；文档备份流程 |
| 日期/时区问题 | 完成记录在错误日期 | 一致的日期处理（date-fns） |
| 范围蔓延 | MVP 无法交付 | 严格遵守 MVP 范围 |

---

## 13. 数据库模式

```sql
CREATE TABLE habits (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    description TEXT,
    color TEXT DEFAULT '#10B981',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    archived_at TIMESTAMP
);

CREATE TABLE completions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    habit_id INTEGER NOT NULL,
    completed_date TEXT NOT NULL,  -- YYYY-MM-DD 格式
    status TEXT NOT NULL DEFAULT 'completed',  -- 'completed' 或 'skipped'
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (habit_id) REFERENCES habits(id) ON DELETE CASCADE,
    UNIQUE(habit_id, completed_date)
);

CREATE INDEX idx_completions_habit_date ON completions(habit_id, completed_date);
```

---

## 14. 未来考虑

### MVP 后增强
- 非每日习惯（每周或特定日期）
- 数据导出（CSV/JSON）
- 深色模式
- 浏览器通知提醒
- 每周/月度报告

### 技术改进
- 单可执行文件打包（PyInstaller）
- 桌面应用（Electron/Tauri）
- PWA 支持（离线能力）
- 数据库迁移（Alembic）
