---
description: 深度代码库分析创建功能实现计划
---

# 功能规划

## 功能: $ARGUMENTS

## 使命

将功能需求转化为**全面的实现计划**，通过系统性代码库分析、外部研究和战略规划。

**核心原则**：此阶段不写代码。目标是创建上下文丰富的计划，使执行 agent 一次成功。

**关键理念**：上下文为王。计划必须包含实现所需的所有信息。

## 规划流程

### 阶段1：功能理解

- 提取核心问题
- 识别用户价值
- 确定类型：新功能/增强/重构/修复
- 评估复杂度：低/中/高
- 映射受影响系统

**用户故事**：
```
作为 <用户类型>
我想 <操作/目标>
以便 <收益/价值>
```

### 阶段2：代码库情报收集

**1. 项目结构分析**
- 检测语言、框架、版本
- 映射目录结构和架构模式
- 定位配置文件

**2. 模式识别**
- 搜索类似实现
- 识别命名约定、错误处理、日志模式
- 检查 CLAUDE.md 项目规则

**3. 依赖分析**
- 编目相关外部库
- 查找 docs/ 或 reference/ 中的文档

**4. 测试模式**
- 识别测试框架和结构
- 找到类似测试示例

**5. 集成点**
- 识别需更新的现有文件
- 确定需创建的新文件
- 映射路由/API 注册模式

**澄清歧义**：需求不清时先询问用户

### 阶段3：外部研究

- 研究最新库版本和最佳实践
- 查找官方文档
- 识别常见陷阱

### 阶段4：深度战略思考

- 如何融入现有架构？
- 关键依赖和操作顺序？
- 可能出错的地方？
- 如何全面测试？
- 性能和安全考虑？

### 阶段5：生成计划

输出到：`.agents/plans/{kebab-case-名称}.md`

## 计划模板

```markdown
# 功能: <功能名>

## 功能描述
<详细描述>

## 用户故事
作为...我想...以便...

## 功能元数据
- **类型**: [新功能/增强/重构/修复]
- **复杂度**: [低/中/高]
- **受影响系统**: [组件列表]

---

## 上下文引用

### 必读代码文件
- `path/to/file.py` (行 15-45) - 原因

### 要创建的新文件
- `path/to/new.py` - 用途

### 必读文档
- [文档链接](url) - 原因

### 要遵循的模式
<从代码库提取的具体模式>

---

## 实现计划

### 阶段1：基础
### 阶段2：核心实现
### 阶段3：集成
### 阶段4：测试验证

---

## 逐步任务

### {操作} {目标文件}
- **实现**: {具体细节}
- **模式**: {参考 - 文件:行}
- **验证**: `{可执行命令}`

---

## 测试策略
### 单元测试
### 集成测试

---

## 验证命令
### 级别1：语法检查
### 级别2：单元测试
### 级别3：集成测试
### 级别4：手动验证

---

## 验收标准
- [ ] 功能实现完整
- [ ] 所有验证通过
- [ ] 测试覆盖 80%+
- [ ] 遵循项目约定
```

## 质量标准

- [ ] 所有必要模式已识别
- [ ] 每个任务有可执行验证命令
- [ ] 任务按依赖排序
- [ ] 模式引用包含文件:行号

## 报告

创建计划后提供：
- 功能和方法摘要
- 计划文件完整路径
- 复杂度评估
- 一次成功的置信度评分
