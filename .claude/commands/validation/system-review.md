---
description: 分析实现与计划的对比以改进流程
---

# 系统审查

对实现与计划的元级分析，识别流程改进。

## 目的

**系统审查不是代码审查**。不是找代码 bug，而是找流程 bug。

**你的工作**：
- 分析计划遵循和偏离模式
- 识别哪些偏离合理/有问题
- 发现流程改进
- 建议更新 CLAUDE.md、计划模板、命令

**理念**：
- 好的偏离揭示计划局限 → 改进规划
- 坏的偏离揭示需求不清 → 改进沟通
- 重复问题揭示缺少自动化 → 创建命令

## 输入

分析四个关键产物：
- **Plan 命令**：`.claude/commands/plan-feature.md`
- **生成的计划**：$1
- **Execute 命令**：`.claude/commands/execute.md`
- **执行报告**：$2

## 分析流程

### 步骤1：理解计划方案
从计划提取：功能、架构、验证步骤、引用模式

### 步骤2：理解实际实现
从执行报告提取：实现内容、偏离、挑战、跳过项

### 步骤3：分类每个偏离

**好的偏离 ✅**：
- 计划假设不存在的东西
- 发现更好模式
- 需要性能优化
- 发现安全问题

**坏的偏离 ❌**：
- 忽略计划约束
- 创建新架构而非遵循现有模式
- 走捷径引入技术债
- 误解需求

### 步骤4：追溯根因
- 计划不清？
- 缺少上下文？
- 缺少验证？

### 步骤5：生成流程改进
- CLAUDE.md 更新
- Plan 命令更新
- 新命令
- 验证补充

## 输出格式

保存到：`.agents/system-reviews/[功能名]-review.md`

### 报告结构

#### 元信息
- 审查计划：[$1 路径]
- 执行报告：[$2 路径]

#### 整体对齐分数：__/10
- 10：完美遵循
- 7-9：小偏离合理
- 4-6：偏离混合
- 1-3：重大问题偏离

#### 偏离分析
```yaml
divergence: [变更内容]
planned: [计划内容]
actual: [实际实现]
classification: good ✅ | bad ❌
root_cause: [计划不清 | 缺少上下文 | 等]
```

#### 系统改进行动

**更新 CLAUDE.md**：
- [ ] 记录 [模式 X]
- [ ] 添加 [Y] 反模式警告

**更新 Plan 命令**：
- [ ] 添加 [缺失步骤]
- [ ] 澄清 [模糊指令]

**创建新命令**：
- [ ] `/[命令名]` 用于 [重复手动流程]

## 重要

- **具体**：不说"计划不清"，说"计划未指定用哪种认证模式"
- **关注模式**：一次性问题不可操作，找重复问题
- **行动导向**：每个发现都应有具体资产更新建议
