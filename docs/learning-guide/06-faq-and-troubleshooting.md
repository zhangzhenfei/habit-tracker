# 常见问题与故障排除 (FAQ & Troubleshooting)

在与 Claude Code 协作时，你可能会遇到以下问题。

## 关于上下文 (Context)

### Q: Claude 好像忘记了我刚才说的话？
**A:** Claude Code 的上下文窗口虽然很大，但不是无限的。
- **现象**：它开始重复之前的错误，或者忽略了 PRD 里的规定。
- **解决**：使用 `/reset` 命令（或手动开启新对话），然后重新加载上下文 ("Read PRD...")。
- **预防**：遵循 "模块化规则架构"，不要一次性加载所有文件。

### Q: 什么时候应该开启新对话？
**A:** 建议在每个主要的 PIV 循环结束后开启新对话。
- **Plan 阶段**：可以在一个对话里反复拉扯。
- **Execute 阶段**：**强烈建议**在一个全新的、干净的对话中进行，只加载 Plan 文件和必要的代码文件。

## 关于代码质量

### Q: Claude 写的代码跑不通怎么办？
**A:** 不要直接自己改。
1. 把报错信息完整复制给它。
2. 询问："你刚才修改了哪些文件？请检查这些修改是否符合 reference/best-practices.md。"
3. 让它运行测试来定位问题。

### Q: Claude 总是引入我不想用的库（比如它想引入 Axios 而不是 fetch）？
**A:** 这是因为规则不够明确。
- **解决**：在 `.claude/reference/` 下对应的最佳实践文件中，明确写上："禁止使用 Axios，必须使用 Fetch API 或 TanStack Query"。
- **原则**：AI 的行为是你规则的镜像。

## 关于工具使用

### Q: `replace` 工具经常失败？
**A:** `replace` 需要极其精确的上下文匹配（Old String 必须完全一致）。
- **技巧**：告诉 Claude "请先读取文件内容，然后再构建 replace 调用，确保 old_string 包含足够的上下文且完全匹配"。

### Q: 运行 shell 命令时卡住了？
**A:** 有些命令（如 `npm run dev`）是持久运行的。
- **解决**：告诉 Claude 使用后台运行方式，或者只运行一次性命令（如 `npm run build`）。对于测试服务器，通常在另一个终端手动运行更方便。

## 紧急救援

如果 AI 彻底搞乱了你的项目：
1. **Git Reset**: `git reset --hard HEAD` (这就是为什么我们要求频繁提交)。
2. **Review Plan**: 回去检查 `.agents/plans/` 下的计划，是不是计划本身就有逻辑漏洞。
